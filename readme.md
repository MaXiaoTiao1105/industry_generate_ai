# 行业研究报告生成系统

## 项目简介

本项目是一个基于 AI 的行业研究报告自动生成系统，能够根据用户提供的行业关键词，自动收集、分析、组织和生成专业的行业研究报告。系统采用多步骤流程，通过先进的大语言模型技术提取关键信息，实现高质量的行业分析报告生成。

## 功能特点

- **多模式报告生成**：支持模板驱动与自动生成两种模式
- **数据可视化**：自动从文本中提取数据并生成多种类型的图表
- **多步骤处理**：分步进行报告结构生成、内容收集、内容优化和最终合并
- **反思优化**：AI 对生成内容进行自我评估和优化，减少幻觉和提高准确性
- **并行处理**：采用多线程技术提高处理效率
- **缓存机制**：减少重复 API 调用，提高响应速度
- **灵活定制**：支持自定义提示词和报告模板

## 系统架构

系统由四个主要步骤组成：

1. **结构生成 (step0)**：分析行业模板，生成报告大纲和章节提示词
2. **内容收集 (step1)**：基于提示词收集各章节内容
3. **内容优化 (step2)**：对收集的内容进行总结、反思和优化，并生成数据可视化图表
4. **报告合并 (step3)**：将所有章节合并成最终报告，并进行格式调整

## 安装与依赖

### 环境要求

- Python 3.8+
- 大语言模型 API (DeepSeek API 和智谱 API)
- Pandoc (用于 PDF 生成)
- XeLaTeX (用于 PDF 渲染)

### 依赖库

```bash
pip install openai matplotlib numpy pandas flask
```

## 使用方法

### 配置 API 密钥

在运行前，请设置环境变量：

```bash
export DS_API_KEY="您的DeepSeek API密钥"
export ZHIPU_API_KEY="您的智谱API密钥"
```

或在代码中直接替换相应变量。

### 运行 Web 界面

```bash
python app.py
```

打开浏览器访问 `http://localhost:5000` 使用 Web 界面。

### 命令行运行

按顺序执行以下脚本：

1. 生成报告结构：

```bash
python step0.py
```

2. 收集行业内容：

```bash
python step1.py
```

3. 内容优化与数据可视化：

```bash
python step2.py
```

4. 生成最终报告：

```bash
python step3.py
```

## 项目结构

```
└── ai_search/
    ├── app.py                # Web应用程序入口
    ├── industry_report_generator.py  # 报告生成主类
    ├── step0.py              # 报告结构生成
    ├── step1.py              # 行业内容收集
    ├── step1_enhance.py      # 增强版内容收集
    ├── step2.py              # 内容优化与可视化
    ├── step3.py              # 最终报告合并
    ├── templates/            # Web界面模板
    │   └── index.html        # 主页面
    ├── static/               # 静态资源
    │   ├── css/              # 样式文件
    │   └── js/               # JavaScript文件
    └── reports/              # 生成的报告存储目录
        ├── step0/            # 报告结构和提示词
        ├── step1/            # 收集的原始内容
        ├── step2/            # 优化后的内容和图表
        └── final/            # 最终报告
```

## 性能优化

本项目实现了多项性能优化：

1. **多线程并行处理**：使用 ThreadPoolExecutor 并行处理多个文件
2. **缓存机制**：避免重复的 API 调用
3. **图表生成优化**：预处理字体设置，使用预计算的颜色方案
4. **模型参数优化**：根据任务调整 temperature 和 max_tokens 参数
5. **错误处理与日志**：详细的日志记录和异常处理

## 输出格式

系统支持两种输出格式：

- **Markdown**：适合在各种 Markdown 查看器中阅读
- **PDF**：使用 Pandoc 和 XeLaTeX 转换生成，支持中文字体和高质量排版

## 自定义与扩展

### 自定义报告模板

上传自己的行业报告模板（Markdown 或 JSON 格式）以定制报告结构。

### 开发自定义处理组件

各步骤组件可独立使用，也可通过修改提示词模板进行自定义。

## 常见问题

**Q: 为什么图片在 PDF 中不显示？**  
A: 确保已安装 XeLaTeX 和必要的中文字体。

**Q: 如何提高生成报告的质量？**  
A: 可以通过优化模板结构，调整 step0 中的提示词，以及修改 step2 中的反思评估标准来提高质量。

**Q: 图表数据不准确怎么办？**  
A: 图表生成依赖于文本中提取的数据。如果图表不准确，可能是因为文本中的数据格式不规范，可以尝试在 step2 中增强数据规范化处理。

## 许可证

[MIT License](LICENSE)

## 致谢

感谢 DeepSeek 和智谱 AI 提供的 API 支持。

---
